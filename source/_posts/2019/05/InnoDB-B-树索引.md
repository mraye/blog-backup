---
title: InnoDB-B+树索引
date: 2019-05-02 13:41:43
tags: [sql, 索引]
categories: [mysql]
---

摘自*MySQL技术内幕-InnoDB存储引擎*

> B+ 树索引的本质就是 B+ 树在数据库中的实现。在数据库一般在2~4层

### B+ 树索引种类

B+ 树索引种类:

+ 聚集索引(`clustered index`)
+ 辅助索引(`secondary index`)


<!-- more -->

相同点:
+ 两者内部实现还是B+树

区别:  

+ 聚集索引叶子节点存储的是一整行的数据
+ 辅助索引叶子节点并不包含行记录的全部数据



### 聚集索引

InnoDB存储引擎表是索引组织表，即表中的数据按照主键顺序存储的。而聚集索引(`clustered index`)就是按照每张表的主键构造一棵B+树，同时叶子节点存放的即为整张表的行记录数据
，也将聚集索引的叶子节点称为数据页。聚集索引的这个特性决定了索引组织表中数据也是索引的一部分。同B+树数据结构一样，每个数据页都通过一个双向链表进行连接。由于实际的数据页只能按照一棵B+树进行排序，**因此每张表只能拥有一个聚集索引**


另外，数据页上存放的是完整的每行的记录，而在非数据页的索引页中，存放的仅仅是键值及指向数据页的偏移量

#### 聚集索引存储

聚集索引的存储并不是物理上连续的，而恰恰是逻辑上的连续


#### 聚集索引优点

+ 聚集索引对于主键的排序查找和范围查找的速度非常快

### 辅助索引

辅助索引(`secondary index`),也称为非聚集索引。叶子节点并不包含行记录的全部数据，叶子节点除了包含键值外，每个叶子节点中的索引行中还包含了一个书签(`bookmark`),该书签用来告诉InnoDB存储引擎在哪里可以找到与索引相对应的行数据。由于InnoDB存储引擎表是索引组织表，因此InnoDB存储引擎的辅助索引的书签就是相应行数据的聚集索引键  


辅助索引的存在并不影响数据在聚集索引的组织，**因此每张表上可以有多个辅助索引**。当辅助索引来寻找数据时，InnoDB存储引擎会遍历辅助索引并通过叶级别的指针获取指向主键索引的主键，然后通过主键索引来找到一个完整的行记录。举例来说，如果在一棵高度为3的辅助索引树中查找数据，那需要对这棵辅助索引树遍历3次找到指定主键，如果聚集索引树的高度同样为3，那还需要对聚集索引树进行3次查找，最终找到一个完整行所在的页，因此一共需要6次逻辑IO访问以得到最终的一个数据页


### B+ 树索引使用

#### 联合索引

联合索引是指对表上的多列进行索引，并满足最左前匹配的规则


#### 覆盖索引

InnoDB存储引擎支持覆盖索引(`covering index`,或称索引覆盖)，即从辅助索引中就可以得到查询的记录，而不需要查询聚集索引中的记录。使用覆盖索引的好处是辅助索引不包含整行记录的所有信息，故其大小远小于聚集索引，因此可以减少大量的IO操作
